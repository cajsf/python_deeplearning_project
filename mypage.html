<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>마이페이지 | 파기딥</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Pretendard:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
</head>
<body class="text-slate-800">

    <nav class="bg-white border-b border-slate-200 fixed w-full z-20 top-0 start-0">
        <div class="max-w-screen-xl flex flex-wrap items-center justify-between mx-auto p-4">
            <a href="index.html" class="flex items-center space-x-3 group">
                <div class="w-8 h-8 bg-emerald-500 rounded-lg flex items-center justify-center text-white font-bold group-hover:bg-emerald-600 transition">P</div>
                <span class="self-center text-2xl font-bold text-emerald-600 tracking-tight">Pagideep</span>
            </a>
            <div>
                <a href="index.html" class="text-slate-500 hover:text-emerald-600 font-medium text-sm mr-4 transition"><i class="fa-solid fa-arrow-left mr-1"></i> 검색으로 돌아가기</a>
                <button onclick="logout()" class="text-red-500 hover:text-red-700 font-medium text-sm transition border border-red-200 px-3 py-1.5 rounded-lg hover:bg-red-50">로그아웃</button>
            </div>
        </div>
    </nav>

    <div class="max-w-screen-xl mx-auto px-4 pt-32 pb-12">
        <div class="flex flex-col lg:flex-row gap-8">
            
            <div class="lg:w-1/3">
                <div class="bg-white rounded-3xl shadow-sm border border-slate-200 p-8 text-center sticky top-32">
                    
                    <div class="relative w-32 h-32 mx-auto mb-4 group cursor-pointer" onclick="document.getElementById('profileUpload').click()">
                        <img id="profileImage" src="https://via.placeholder.com/150?text=USER" class="w-32 h-32 rounded-full object-cover border-4 border-slate-100 shadow-inner" alt="프로필">
                        <div class="absolute inset-0 bg-black bg-opacity-40 rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition text-white font-bold">
                            <i class="fa-solid fa-camera mr-1"></i> 변경
                        </div>
                        <input type="file" id="profileUpload" class="hidden" accept="image/*" onchange="uploadProfileImage(this)">
                    </div>

                    <div class="mb-6">
                        <div class="flex items-center justify-center gap-2 mb-1">
                            <h2 class="text-2xl font-bold text-slate-900" id="profileName">사용자</h2>
                            <button onclick="editNickname()" class="text-slate-400 hover:text-emerald-500 text-sm"><i class="fa-solid fa-pen"></i></button>
                        </div>
                        <p class="text-sm text-slate-400">@<span id="profileUsername">userid</span></p>
                        <p class="text-xs mt-1 text-slate-500 font-medium bg-slate-100 inline-block px-2 py-0.5 rounded" id="userRole">로딩중...</p>
                    </div>

                    <div id="nicknameForm" class="hidden mb-6 bg-slate-50 p-3 rounded-xl">
                        <div class="flex gap-2">
                            <input type="text" id="newNicknameInput" class="w-full p-2 border border-slate-200 rounded-lg text-sm focus:outline-none focus:border-emerald-500" placeholder="새 닉네임">
                            <button onclick="saveNickname()" class="bg-emerald-500 hover:bg-emerald-600 text-white px-6 rounded-lg text-sm font-bold transition">저장</button>
                        </div>
                    </div>
                    
                    <hr class="border-slate-100 my-6">

                    <button onclick="togglePwForm()" class="w-full py-3 border border-slate-200 text-slate-600 rounded-xl font-bold hover:bg-slate-50 mb-3 transition text-sm">
                        <i class="fa-solid fa-lock mr-2"></i> 비밀번호 변경
                    </button>

                    <div id="pwForm" class="hidden bg-slate-50 p-4 rounded-xl text-left mb-4 border border-slate-200">
                        <input type="password" id="currentPw" placeholder="현재 비밀번호" class="w-full p-2 mb-2 border rounded-lg text-sm outline-none focus:border-emerald-500">
                        <input type="password" id="newPw" placeholder="새 비밀번호" class="w-full p-2 mb-2 border rounded-lg text-sm outline-none focus:border-emerald-500">
                        <input type="password" id="confirmPw" placeholder="새 비밀번호 확인" class="w-full p-2 mb-3 border rounded-lg text-sm outline-none focus:border-emerald-500">
                        <button onclick="changePassword()" class="w-full bg-slate-800 hover:bg-slate-900 text-white py-2 rounded-lg text-sm font-bold transition">변경하기</button>
                    </div>

                    <a href="admin.html" id="adminBtn" class="hidden block w-full py-3 bg-slate-900 text-white rounded-xl font-bold text-sm hover:bg-black transition shadow-md mb-4">
                        <i class="fa-solid fa-gauge-high mr-2"></i> 관리자 대시보드
                    </a>

                    <button onclick="deleteAccount()" class="text-xs text-red-400 hover:text-red-600 underline transition mt-2">회원 탈퇴하기</button>
                </div>
            </div>

            <div class="lg:w-2/3">
                <div class="bg-white rounded-3xl shadow-sm border border-slate-200 p-8">
                    <div class="mb-6 border-b border-slate-100 pb-4 flex justify-between items-end">
                        <div>
                            <h2 class="text-xl font-bold text-slate-900 mb-2"><i class="fa-solid fa-shield-virus text-emerald-500 mr-2"></i>나의 알레르기 관리</h2>
                            <p class="text-sm text-slate-500">
                                가지고 계신 알레르기 항목을 모두 선택해주세요. <br>
                                선택된 정보는 검색 결과에서 <span class="text-red-500 font-bold">위험 경고</span>를 띄우는 데 사용됩니다.
                            </p>
                        </div>
                        <span class="text-slate-400 font-bold text-sm bg-slate-100 px-3 py-1 rounded-full" id="allergyCount">0개 선택됨</span>
                    </div>

                    <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-3" id="myAllergyContainer">
                        </div>

                    <div class="mt-8 p-4 bg-emerald-50 rounded-xl border border-emerald-100 flex items-start">
                        <i class="fa-solid fa-lightbulb text-emerald-500 mt-1 mr-3"></i>
                        <p class="text-sm text-emerald-800">
                            <strong>자동 저장:</strong> 별도의 저장 버튼이 없습니다.<br>
                            항목을 클릭하면 즉시 데이터베이스에 반영됩니다.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>